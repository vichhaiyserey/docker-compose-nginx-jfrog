########################################################### 
## this configuration was generated by JFrog Artifactory ## 
########################################################### 
  
## add HA entries when ha is configure 
upstream artifactory { 
	server artifactory:8082; 
} 
upstream artifactory-direct { 
	server artifactory:8081; 
} 
## add ssl entries when https has been set in config 
#ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; 
#ssl_certificate  	/var/opt/artifactory-ha.crt; 
#ssl_certificate_key  /var/opt/artifactory-ha.key; 
#ssl_session_cache shared:SSL:1m; 
#ssl_prefer_server_ciphers   on; 
## server configuration 
server { 
	#listen 443 ssl; 
     	listen 80;
	server_name jweb; 


	if ($http_x_forwarded_proto = '') { 
    	set $http_x_forwarded_proto  $scheme; 
	} 
	## Application specific logs 
	## access_log /var/log/nginx/jfrog-access.log timing; 
	## error_log /var/log/nginx/jfrog-error.log; 
	rewrite ^/$ /ui/ redirect; 
	rewrite ^/ui$ /ui/ redirect; 
	chunked_transfer_encoding on; 
	client_max_body_size 0; 
	location / { 
	proxy_read_timeout  2400s; 
	proxy_pass_header   Server; 
	proxy_cookie_path   ~*^/.* /; 
	proxy_buffer_size 128k; 
	proxy_buffers 40 128k; 
	proxy_busy_buffers_size 128k; 
	proxy_pass      	http://artifactory; 
	proxy_next_upstream error timeout non_idempotent; 
	proxy_next_upstream_tries	1; 
	proxy_set_header	X-JFrog-Override-Base-Url $http_x_forwarded_proto://$host:$server_port; 
	proxy_set_header	X-Forwarded-Port  $server_port; 
	proxy_set_header	X-Forwarded-Proto $http_x_forwarded_proto; 
	proxy_set_header	Host          	$http_host; 
	proxy_set_header	X-Forwarded-For   $proxy_add_x_forwarded_for; 
	add_header X-Content-Type-Options "nosniff" always; 
	add_header Strict-Transport-Security always; 
  
    	location ~ ^/artifactory/ { 
        	proxy_pass	http://artifactory-direct; 
    	} 
	} 
} 

